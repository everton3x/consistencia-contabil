<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Consistência Contábil: data base {{ database }}</title>
</head>
<body>
    <h1>Teste de Consistência Contábil</h1>
    <h2>Perfil: {{ perfil }}</h2>
    <h3>Data base de {{ database }}</h3>

    <h2>Resumo</h2>
    <table>
        <thead>
            <tr>
                <th>Regra</th>
                <th>Valor Esquerdo</th>
                <th>Valor Direito</th>
                <th>Diferença</th>
            </tr>
        </thead>
        <tbody>
        {% for index, item in summary.iterrows() %}
        <tr>
            <td><a href="#{{ item['rule'] }}">{{ item['rule'] }}</a></td>
            <td>{{ item['left'] }}</td>
            <td>{{ item['right'] }}</td>
            <td>{{ item['diff'] }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

    <h2>Detalhamento dos testes</h2>
    {% for rulename, item in details.items() %}
        <a id="{{ rulename }}"></a>
        <table border="1">
            <caption>{{ rulename }}</caption>
            <thead>
                <tr>
                    <th colspan="4">Esquerda</th>
                    <th colspan="4">Direita</th>
                    <th rowspan="2">Diferença</th>
                </tr>
                <tr>
                    <th>Tabela</th>
                    <th>Campo</th>
                    <th>Filtro</th>
                    <th>Valor</th>
                    <th>Tabela</th>
                    <th>Campo</th>
                    <th>Filtro</th>
                    <th>Valor</th>
                </tr>
            </thead>
            <tbody>
            {% for i in item['items'] %}
                {% if i['l_minus'] %}
                    {% set l_minus = '(-) ' %}
                {% else %}
                    {% set l_minus = ' ' %}
                {% endif %}
                {% if i['r_minus'] %}
                    {% set r_minus = '(-) ' %}
                {% else %}
                    {% set r_minus = ' ' %}
                {% endif %}
                <tr>
                    <td>{{ i['l_dataset'] }}</td>
                    <td>{{ l_minus }} {{ i['l_field'] }}</td>
                    <td>{{ i['l_filter'] }}</td>
                    <td>{{ i['l_value'] }}</td>
                    <td>{{ r_minus }} {{ i['r_dataset'] }}</td>
                    <td>{{ i['r_field'] }}</td>
                    <td>{{ i['r_filter'] }}</td>
                    <td>{{ i['r_value'] }}</td>
                    <td></td>
                </tr>
            {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <th colspan="3">Total</th>
                    <th>{{ item['total']['left_val'] }}</th>
                    <th colspan="3">Total</th>
                    <th>{{ item['total']['right_val'] }}</th>
                    <th>{{ item['total']['diff'] }}</th>
                </tr>
            </tfoot>
        </table>
    {% endfor %}
</body>
</html>